{{ $cat := .cat }}
{{ $lang := .lang }}
{{ $cats := .cats }}
<div class="column is-12-mobile is-6-tablet is-4-desktop">
  <div class="card cat-card" id="cat-{{ $cat.id }}" data-year="{{ substr $cat.birth 0 4 }}" data-birth="{{ $cat.birth }}" data-sterilized="{{ if $cat.sterilized }}yes{{ else }}no{{ end }}" data-treatment="{{ if (index $cat.treatment $lang) }}yes{{ else }}no{{ end }}" data-gender="{{ $cat.gender }}">
    <div class="card-image">
      <figure class="image is-3by2">
        <img class="cat-photo" src="{{ $cat.photo }}" alt="{{ index $cat.name $lang }}">
      </figure>
    </div>
    <div class="card-content">
      <div class="is-flex is-align-items-center is-justify-content-space-between mb-2">
        <div class="is-flex is-align-items-center">
          <p class="title is-5 mb-0">{{ index $cat.name $lang }}</p>
          <span class="icon cat-gender ml-2" data-gender="{{ $cat.gender }}">
            <i class="fas {{ if eq $cat.gender "male" }}fa-mars has-text-link{{ else }}fa-venus has-text-danger{{ end }}"></i>
          </span>
        </div>
        <p class="is-size-7 mb-0 cat-age"></p>
      </div>
      <p class="content mb-2">{{ index $cat.description $lang }}</p>
      <div class="tags mt-2">
        <span class="tag {{ if $cat.sterilized }}is-success{{ else }}is-warning{{ end }}">
          {{ if $cat.sterilized }}{{ i18n "filterSterilized" }}{{ else }}{{ i18n "filterNotSterilized" }}{{ end }}
        </span>
        {{ $t := index $cat.treatment $lang }}
        {{ if $t }}<span class="tag is-danger">{{ $t }}</span>{{ end }}
        {{ range $id := $cat.parents }}
          {{ $p := index (where $cats "id" $id) 0 }}
          {{ if $p }}
            {{ $key := cond (eq $p.gender "female") "mother" "father" }}
            <span class="tag is-info cat-relative" data-target="cat-{{ $p.id }}">{{ i18n $key }}: {{ index $p.name $lang }}</span>
          {{ end }}
        {{ end }}
        {{ $children := where $cats "parents" "intersect" (slice $cat.id) }}
        {{ range $child := $children }}
          {{ $key := cond (eq $child.gender "female") "daughter" "son" }}
          <span class="tag is-info cat-relative" data-target="cat-{{ $child.id }}">{{ i18n $key }}: {{ index $child.name $lang }}</span>
        {{ end }}
        {{ if $cat.parents }}
          {{ $siblings := uniq (where (where $cats "id" "ne" $cat.id) "parents" "intersect" $cat.parents) }}
          {{ range $sib := $siblings }}
            {{ $key := cond (eq $sib.gender "female") "sister" "brother" }}
            <span class="tag is-info cat-relative" data-target="cat-{{ $sib.id }}">{{ i18n $key }}: {{ index $sib.name $lang }}</span>
          {{ end }}
        {{ end }}
      </div>
    </div>
  </div>
</div>
