{{ define "main" }}
<section class="section cat-gallery">
  <div class="container">
    <div class="cat-links is-flex is-flex-wrap-wrap is-justify-content-center mb-4">
      {{ $lang := .Site.Language.Lang }}
      {{ $all := slice }}
      {{ range .Site.Data.cats }}
        {{ $all = $all | append . }}
      {{ end }}
      {{ range sort $all "birth" "desc" }}
        {{ $catURL := partial "cat-profile-url.html" (dict "id" .id) }}
        {{ $photo := "/media/cat-placeholder.svg" }}
        {{ if .avatar }}
          {{ $photo = .avatar }}
        {{ else if gt (len .photos) 0 }}
          {{ $photo = index .photos 0 }}
        {{ end }}
        <a class="cat-link" href="{{ $catURL }}">
          <figure class="image is-48x48">
            <img src="{{ $photo }}" alt="{{ index .name $lang }}" class="is-rounded">
          </figure>
          <span>{{ index .name $lang }}</span>
        </a>
      {{ end }}
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const id = new URLSearchParams(window.location.search).get('id');
  if (!id) return;
  const sanitized = id.replace(/[^A-Za-z0-9_-]/g, '');
  if (!sanitized) return;
  window.location.replace('{{ "cats/" | relLangURL }}' + encodeURIComponent(sanitized.toLowerCase()) + '/');
});
</script>
{{ end }}
